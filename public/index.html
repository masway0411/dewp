<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Search Articles</title>

<meta name="description" content="Search latest articles with fast loading and clean experience.">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="preconnect" href="https://raw.githubusercontent.com">
<link rel="dns-prefetch" href="https://raw.githubusercontent.com">

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  color: #111;
}
header {
  border-bottom: 1px solid #eee;
  padding: 16px;
}
nav a {
  margin-right: 14px;
  text-decoration: none;
  color: #333;
  font-weight: 500;
}
main {
  max-width: 1100px;
  margin: auto;
  padding: 16px;
}
form {
  margin: 20px 0;
}
input[type="search"] {
  width: 100%;
  padding: 12px;
  font-size: 16px;
}
.posts {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 20px;
}
article {
  border: 1px solid #eee;
  border-radius: 6px;
  overflow: hidden;
}
article img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}
article h2 {
  font-size: 18px;
  margin: 12px;
}
article p {
  margin: 0 12px 12px;
  font-size: 14px;
  color: #555;
}
footer {
  border-top: 1px solid #eee;
  margin-top: 40px;
  padding: 20px;
  text-align: center;
  font-size: 14px;
  color: #666;
}
</style>
</head>

<body>

<header>
  <nav>
    <a href="/">Home</a>
    <a href="/about.html">About Us</a>
    <a href="/contact.html">Contact</a>
    <a href="/disclaimer.html">Disclaimer</a>
    <a href="/privacy-policy.html">Privacy Policy</a>
  </nav>
</header>

<main>
  <h1>Search Articles</h1>

  <!-- SEARCH FORM (ENTER FIX) -->
  <form id="searchForm">
    <input id="searchInput" type="search" placeholder="Type keyword and press Enter">
  </form>

  <!-- LOCAL RESULT -->
  <div id="results" class="posts"></div>

  <!-- GOOGLE CSE FALLBACK -->
  <div class="gcse-searchresults-only" style="display:none"></div>
</main>

<footer>
  Â© <span id="year"></span> Your Website
</footer>

<!-- LOAD GOOGLE CSE -->
<script async src="https://cse.google.com/cse.js?cx=d1bdd361602674021"></script>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

const form = document.getElementById("searchForm");
const input = document.getElementById("searchInput");
const results = document.getElementById("results");
const cseBox = document.querySelector(".gcse-searchresults-only");

let indexData = [];

/* LOAD INDEX */
fetch("/index.json")
  .then(r => r.json())
  .then(data => {
    indexData = data;
    render(indexData.slice(0,10));
  });

/* ENTER KEY FIX */
form.addEventListener("submit", e => {
  e.preventDefault(); // ðŸ”¥ VERY IMPORTANT
  runSearch(input.value);
});

/* SEARCH LOGIC */
function runSearch(query) {
  const q = query.trim().toLowerCase();

  results.innerHTML = "";
  cseBox.style.display = "none";

  if (!q) {
    render(indexData.slice(0,10));
    return;
  }

  const local = indexData.filter(p =>
    p.title.toLowerCase().includes(q) ||
    p.slug.includes(q)
  );

  if (local.length > 0) {
    render(local.slice(0,10));
  } else {
    cseBox.style.display = "block";

    if (window.google && google.search) {
      google.search.cse.element
        .getElement("searchresults-only")
        .execute(q);
    }
  }
}

/* RENDER LOCAL RESULT */
function render(posts) {
  results.innerHTML = posts.map(p => `
    <article>
      <a href="${p.url}">
        <img src="${p.image || '/assets/no-image.jpg'}" loading="lazy">
      </a>
      <h2><a href="${p.url}">${p.title}</a></h2>
      <p>${p.excerpt || ""}</p>
    </article>
  `).join("");
}
</script>

</body>
</html>
